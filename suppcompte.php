<?php/** * Delete account script * * @author Pierre HUBERT *///On inclus la sécuritéinclude('securite.php');//Initialize pageinclude('inc/initPage.php');?><!DOCTYPE html><html>	<head>		<title>Suppression de compte</title>		<?php include(pagesRelativePath('common/head.php')); ?>		<style>			.boutonconfirmation			{				text-align: center;			}		</style>	</head>	<body>		<?php 		if(!isset($_GET['confirm']) OR !isset($_POST['password']))		{			 include(pagesRelativePath('common/pageTop.php')); ?>			<p><span style="font-size: large;"><?php echo code_inc_img(path_img_asset('delete_user.png'), "Suppression de compte"); ?>Confirmation de suppression de compte</span></p>			<p><span style="font-size: small;">Avez-vous pens&eacute; &agrave; <a title="Exportation des don&eacute;es personnelles" href="parametres.php?c=exportinfo">exporter vos donn&eacute;es personnelles ?</a></span></p>			<p><span style="font-size: small;">Avez-vous pr&eacute;venu <a title="Afficher la liste d'amis" href="amis.php">vos amis ?</a></span></p>			<p><span style="font-size: small;">RAPPEL : CE PROCESSUS EST IRREVERSIBLE!</span></p>			<p>&nbsp;</p>			<div style="background-color: #ff0000;"><span style="color: #ffffff;">La suppression de donn&eacute;es personnelles est irr&eacute;versible. V&eacute;rifier que vous avez bien rempli les conseils situ&eacute;s &agrave; gauche puis confirmez la suppression physique de votre compte</span></div>			<div class='boutonconfirmation'>				<a title="Retourner &agrave; la page d'acceuil" href="index.php"><span style="font-size: medium; background-color: #00ff00; color: #000000;">ANNULER</span></a>				<span style="font-size: medium; background-color: #ff0000; color: #000000;"><form action="<?php echo $_SERVER['PHP_SELF']; ?>?confirm" method="post"><input type="password" name="password" placeholder="Mot de passe SVP" /> <input type='submit' value="Confirmer" /></a></span>			</div>			<?php		}		else		{			?><pre><?php			?><br /><?php			?> **************************************<br /><?php			?> *                                    *<br /><?php			?> *  Service de suppresion de compte   *<br /><?php			?> *  Comunic, veuillez patienter....   *<br /><?php			?> *                                    *<br /><?php			?> *       (c) Pierre HUBERT            *<br /><?php			?> *                                    *<br /><?php			?> **************************************<br /><?php			?><br /><?php			?>Nous sommes tristes de vous voir partir ! Si vous effectuez une suppression de compte pour vous recr&eacute;er un compte propre par la suite, sachez que vous serez toujours le bienvenue dans ce service, nous respecteront toujours votre vie pri&eacute;e...<?php			?><br /><?php			?><br /><?php			?><br /><?php			?>Suppression de compte en cours....<br /><?php 			?>Veuillez patienter, le temps de suppression d&eacute;pend du volume de donn&eacute;es &agrave; supprimer...<br /><?php 			?>Contr&ocirc;le du mot de passe...<?php 				//Récupération des informations				$afficher = cherchenomprenom($_SESSION['ID'], $bdd);								//Cryptage du mot de passe envoyé				if(crypt_password($_POST['password']) != $afficher['password'])					die("Mot de passe invalide! Quitte le script.");				else					echo "Mot de passe correct.<br />";					?>Suppression de vos j'aimes<br /><?php			//Suppression des j'aime			$sql = "DELETE FROM aime WHERE ID_personne = ".$_SESSION['ID'];			$resultat = $bdd->query($sql);			echo " Termine. <br />";						?>Suppression des textes et des images avec les commentaires associés de votre page d'acceuil.<br /><?php						//On supprime les textes			$listetextes = affichertextes($_SESSION['ID'], $bdd, 0, 1000000000000);						foreach($listetextes as $supprimertexte)			{				//On vérifie si une image est rattaché au texte				if($supprimertexte['type'] == "image" || $supprimertexte['type'] == "pdf")					unlink($supprimertexte['path']); //Suppression de l'image								//On supprime le texte				deletetexte($supprimertexte['ID'], $supprimertexte['texte'], $bdd);			}			echo "Termin&eacute;. <br />";						//On supprime les textes postés sur les pages des amis			echo "Suppression de vos posts sur les pages de vos amis <br />";			$sql = "SELECT * FROM texte WHERE ID_amis = ".$_SESSION['ID'];			$resultat = $bdd->query($sql);						//Listing et suppression			while($delete = $resultat->fetch())			{				//On vérifie si une image est rattaché au texte				if($supprimertexte['type'] == "image")					unlink($supprimertexte['path']); //Suppression de l'image								//On supprime le texte				deletetexte($supprimertexte['ID'], $supprimertexte['texte'], $bdd);			}			$resultat->closeCursor();			echo "Termin&eacute;. <br />";						//On supprime les groupes créés par l'utilisateur			echo "Suppression de vos groupes <br />";			$sql = "DELETE FROM groupes_personnes WHERE ID_personne = ".$_SESSION['ID'];			$resultat = $bdd->query($sql);			echo "Termin&eacute;. <br />";						//On supprime toutes les vidéos de l'utilisateur			echo "Supression de toute vos vid&eacute;os <br />";			$liste_video = liste_videos_user($_SESSION['ID'], $bdd); //Récupération de la liste des vidéos			foreach($liste_video as $video) //Parcours de toute les vidéos				delete_movie($video['ID'], $_SESSION['ID'], $bdd); //Suppression de la vidéo			echo "Termin&eacute;. <br />";						//On supprime les commentaires			echo "Suppression de vos commentaires <br />";			$sql = "DELETE FROM commentaire WHERE ID_personne = ".$_SESSION['ID'];			$resultat = $bdd->query($sql);			echo "Termin&eacute;. <br />";						//On supprime les amis			echo "Suppression de votre liste d'amis <br />";			$sql = "DELETE FROM amis WHERE (ID_personne = ".$_SESSION['ID'].") || (ID_amis = ".$_SESSION['ID'].")";			$resultat = $bdd->query($sql);			echo "Termin&eacute;. <br />";						//On supprime les contacts avec l'administration			echo "Suppression de vos contacts avec l'administration <br />";			$sql = "DELETE FROM contact WHERE ID_personne = ".$_SESSION['ID'];			$resultat = $bdd->query($sql);			echo "Termin&eacute;. <br />";						//On vide la messagerie			echo "Nettoyage de la messagerie <br />";			$sql = "DELETE FROM messagerie WHERE (ID_expediteur = ".$_SESSION['ID'].") || (ID_destinataire = ".$_SESSION['ID'].")";			$resultat = $bdd->query($sql);			echo "Termin&eacute;. <br />";						//On vide le chat			echo "Suppression de vos posts sur le chat <br />";			$sql = "DELETE FROM chat WHERE ID_personne = ".$_SESSION['ID'];			$resultat = $bdd->query($sql);			echo "Termin&eacute;. <br />";						//On vide le chat prive			echo "Suppression de vos posts sur le chat priv&eacute; <br />";			$sql = "DELETE FROM chatprive WHERE ID_personne = ".$_SESSION['ID']." || ID_destination = ".$_SESSION['ID'];			$resultat = $bdd->query($sql);			echo "Termin&eacute;. <br />";						//On vide les sous-pages			echo "Suppression de vos pages <br />";			$sql = "DELETE FROM pages WHERE ID_personne = ".$_SESSION['ID'];			$resultat = $bdd->query($sql);			echo "Termin&eacute;. <br />";						//On vide les notifications			echo "Suppression de vos notifications <br />";			$sql = "DELETE FROM chatprive WHERE ID_personne = ".$_SESSION['ID']." || ID_createur = ".$_SESSION['ID'];			$resultat = $bdd->query($sql);			echo "Termin&eacute;. <br />";						//On supprime l'avatar			echo "Suppression de l'avatar <br />";			if(file_exists(relativeUserDataFolder('avatars/adresse_avatars/'.$_SESSION['ID'].'.txt')))			{				unlink(relativeUserDataFolder('avatars/'.file_get_contents('avatars/adresse_avatars/'.$_SESSION['ID'].'.txt')));				unlink(relativeUserDataFolder('avatars/adresse_avatars/'.$_SESSION['ID'].'.txt'));								//On vérifie si un niveau de visibilité personnalisé de l'avatar a été défini				if(file_exists(relativeUserDataFolder('avatars/adresse_avatars/limit_view_'.$_SESSION['ID'].'.txt')))				{					unlink(relativeUserDataFolder('avatars/adresse_avatars/limit_view_'.$_SESSION['ID'].'.txt'));				}			}			echo "Termin&eacute;.<br />";						//On supprime l'image de fond			echo "Suppression de l'image de fond <br />";			if(file_exists(relativeUserDataFolder('imgfond/adresse_imgfond/'.$_SESSION['ID'].'.txt')))			{				unlink(relativeUserDataFolder('imgfond/'.file_get_contents('imgfond/adresse_imgfond/'.$_SESSION['ID'].'.txt')));				unlink(relativeUserDataFolder('imgfond/adresse_imgfond/'.$_SESSION['ID'].'.txt'));			}			echo "Termin&eacute;.<br />";						//On supprime les informations générales			echo "Suppression des informations de connexion et des informations g&eacute;n&eacute;rales <br />";			$sql = "DELETE FROM utilisateurs WHERE ID = ".$_SESSION['ID'];			$resultat = $bdd->query($sql);			echo "Termin&eacute;. <br />";						//Déconnexion de la personne			echo "D&eacute;connexion d&eacute;finitive <br />";			session_destroy();			echo "Termin&eacute;. <br />";			?>Suppression de compte termin&eacute;e.<br /><?php			?></pre><?php			?><a href='index.php' title="Retour &agrave; la page d'acceuil">Retour &agrave;  la page d'acceuil du site</a><?php		}		?>	</body></html>